\pdfoutput=1
% ***********************************************************
% ******************* PHYSICS HEADER ************************
% ***********************************************************
% Version 2
%\documentclass[11pt,twocolumn]{article}
\documentclass[aps,onecolumn,superscriptaddress,notitlepage]{revtex4-1}


\usepackage{amsmath} % AMS Math Package
\usepackage{amsthm} % Theorem Formatting
\usepackage{amssymb}	% Math symbols such as \mathbb
\usepackage{physics}
\usepackage[pdftex]{graphicx}
\usepackage{hyperref} %clickable references.
\hypersetup{
    colorlinks,
    citecolor=blue,
    filecolor=black,
    linkcolor=red,
    urlcolor=blue
}
\usepackage{xcolor}
\usepackage{url}

\newcommand{\comment}[1]{{\color{blue}#1}}
\newcommand{\edit}[1]{{\color{violet}#1}}
\newcommand{\del}[1]{{\color{red}\st{#1}}}



% ***********************************************************
% ********************** END HEADER *************************
% ***********************************************************

\begin{document}

\title{Quasi-thermodynamic Push-Pull Models}
\author{Jason W. Rocks}
\author{Pankaj Mehta}
\maketitle


\section{One-way Push Model}


In this model, we have a substrate $S^u$ and a writer (kinase) $W$. 
The writer is able to phosporylate the substrate from $S^u$ to $S^p$.
In this model, we do not explicitly include an eraser (phosphatase), 
but there is a dephosphoralation background rate (and a phosphoralation background rate).

\textbf{Reactions:}
\begin{gather}
W + S^u \leftrightarrows WS^u \rightarrow WS^p \leftrightarrows W + S^p
\end{gather}
\textbf{Background Reactions:}
\begin{gather}
S^p \leftrightarrows S^u\\
WS^p \leftrightarrows WS^u
\end{gather}


\textbf{Total Concentrations:}
We define total concentrations for each species and also separately for unphosporylated and phosporylated states.
\begin{itemize}
\item Total writer: $[W_T] = [W] + [WS^u] + [WS^p]$
\item Total substrate: $[S_T] = [S^u_T] + [S^p_T]$
\item Total unphosporylated substrate: $[S^u_T] = [S^u] + [WS^u]$
\item Total phosporylated substrate: $[S^p_T] = [S^p] + [WS^p]$
\end{itemize}
If we know the 

\textbf{Binding Energies:}
We assume the binding energies are the same for the unphosporylated and phosporylated states.
\begin{itemize}
\item Writer + substrate: $\Delta\epsilon_{WS}$
\end{itemize}

\textbf{One-way Reaction Rates:}
These are the reaction rates that cannot be described by binding energies.
\begin{itemize}
\item Phosphorylation of substrate by writer: $k_{WS}^p$
\item Background phosphorylation of substrate (independent of binding state): $k_S^p$
\item Background dephosphorylation of substrate (independent of binding state): $k_S^u$
\end{itemize}

\textbf{Partition Functions and Probabilities:}
We write down partition functions for each species based on the states listed in the total concentrations above. 
Partition function cannot mix unphosporylated and phosporylated states for the same species, 
so we do not write down a partition function for the total $S$.
We assume the unbound state of each species is zero energy (although this choice doesn't matter).
\begin{itemize}
\item Writer: $Z_W = 1 + e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[S^u])} + e^{-\beta(\Delta\epsilon_{WS} -k_BT \log[S^p])}$
\item Unphosphorylated substrate: $Z_{S^u} = 1 + e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[W])}$
\item Phosphorylated substrate: $Z_{S^p} = 1 + e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[W])}$
\end{itemize}
We define the reaction velocity
\begin{align}
v_{WS} &= e^{-\beta\Delta\epsilon_{WS}}
\end{align}
The associated conditional probabilities are then
\begin{align}
p(W|S^u,S^p) &= \frac{[W]}{[W_T]} = \frac{1}{Z_W} =  \frac{1}{1 + v_{WS}([S^u] +[S^p])}\\
p(WS^u|S^u,S^p) &= \frac{[WS^u]}{[W_T]}  = \frac{e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[S^u])}}{Z_W} =  \frac{v_{WS}[S^u]}{1 + v_{WS}([S^u] +[S^p])}\\
p(WS^p|S^u,S^p) &= \frac{[WS^p]}{[W_T]}  = \frac{e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[S^p])}}{Z_W} =  \frac{v_{WS}[S^p]}{1 + v_{WS}([S^u] +[S^p])}
\end{align}
\begin{align}
p(S^u|W) &= \frac{[S^u]}{[S^u_T]} = \frac{1}{Z_{S^u}} = \frac{1}{1 + v_{WS}[W]}\\
p(WS^u|W) &= \frac{[WS^u]}{[S^u_T]} = \frac{ e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[W])}}{Z_{S^u}} = \frac{v_{WS}[W]}{1 + v_{WS}[W]}
\end{align}
\begin{align}
p(S^p|W) &= \frac{[S^p]}{[S^p_T]} = \frac{1}{Z_{S^p}} = \frac{1}{1 + v_{WS}[W]}\\
p(WS^p|W) &= \frac{[WS^p]}{[S^p_T]} = \frac{ e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[W])}}{Z_{S^p}} = \frac{v_{WS}[W]}{1 + v_{WS}[W]}
\end{align}


\textbf{Reactions in Detailed Balance:}
From the probabilities, we focus on the equations for the concentration of each species in its unbound state.
These correspond to the kinetic equations for reactions not involving (de)phosphorylation.
\begin{align}
\frac{[W]}{[W_T]} & = \frac{1}{1 + v_{WS}([S^u] +[S^p])}\label{eq:onewayW}\\
\frac{[S^u]}{[S^u_T]} &= \frac{1}{1 + v_{WS}[W]}\label{eq:onewaySu}\\
\frac{[S^p]}{[S^p_T]} &=  \frac{1}{1 + v_{WS}[W]}\label{eq:onewaySp}
\end{align}

\textbf{Reactions not in  Detailed Balance:}
This is the kinetic equation for reactions involving (de)phosphorylation. 
It is possible for either $S^u$ or $WS^u$ to undergo this process, so we have two equations
\begin{align}
\dv{[S^p]}{t} &=  k_{WS}^-[WS^p] - k_{WS}^+[W][S^p] + k_S^p[S^u] - k_S^u[S^p]\\
\dv{[WS^p]}{t} &= k_{WS}^+[W][S^p] -k_{WS}^-[WS^p] + k_{WS}^p[WS^u] + k_S^p[WS^u] - k_S^u[WS^p]\\
\dv{[S^u]}{t} &=  k_{WS}^-[WS^u] - k_{WS}^+[W][S^u] + k_S^u[S^p] - k_S^p[S^u]\\
\dv{[WS^u]}{t} &= k_{WS}^+[W][S^u] -k_{WS}^-[WS^u] - k_{WS}^p[WS^u] + k_S^u[WS^p] - k_S^p[WS^u]
\end{align}
where we have defined the forward and backward dissociation rates $k_{WS}^+$ and $k_{WS}^-$ such that
\begin{align}
v_{WS} &= \frac{k_{WS}^+}{k_{WS}^-}
\end{align}
Instead of writing these four equations, we can instead write the kinetic equations so that they only describe reactions that are not in detailed balance and do not depend on $k_{WS}^+$ and $k_{WS}^-$. To see what these equations are, we can simple write down the reaction rates for the total phosphorylated and unphosphorylated substrate.
These will just be related by a negative sign since they sum to a constant, so we can write
\begin{align}
\dv{[S^p_T]}{t} &= k_{WS}^p[WS^u] + k_S^p[S_T^u] - k_S^u[S_T^p]\\
&= k_{WS}^p[S_T^u]p(WS^u|W) + k_S^p[S_T^u] - k_S^u[S_T^p]\\
&= k_{WS}^p([S_T]-[S_T^p])p(WS^u|W) + k_S^p([S_T]-[S_T^p]) - k_S^u[S_T^p]
\end{align}
We note that this equation can also be obtained by summing together the first two kinetic equations. Similarly, the equation for $[S^u_T]$ can be obtained by summing the last two kinetic equations.


Setting this equation to zero, we get
\begin{align}
\frac{[S_T^p]}{[S_T]} &= \frac{k_{WS}^p p(WS^u|W) + k_S^p}{k_{WS}^p p(WS^u|W) + k_S^p+k_S^u}\\
& = \frac{v_{WS}^p p(WS^u|W) + v_S^p}{v_{WS}^p p(WS^u|W) + v_S^p+1}
\end{align}
where we have defined the reaction velocities relative to the background dephosphorylation rate,
\begin{align}
v_{WS}^p &= \frac{k_{WS}^p}{k_S^u}\\
v_S^p &= \frac{k_S^p}{k_S^u}
\end{align}

\textbf{Numerical Strategy:}

We assume that  $[W_T]$ and $[S_T]$ are known. 
Add together Eqs.~\eqref{eq:onewaySu}and\eqref{eq:onewaySp} and defining $[S_f] = [S^p]+[S^u]$, 
we find a pair of equations that can be solved for $[W]$ and $[S_f]$,
\begin{align}
\frac{[W]}{[W_T]} & = \frac{1}{1 + v_{WS}[S_f]}\\
\frac{[S^f]}{[S_T]} &= \frac{1}{1 + v_{WS}[W]}
\end{align}
Combining these equations, we find a quadratic equation in terms of $S_f$,
\begin{align}
0 &= v_{WS}[S_f]^2 +  \qty(1+v_{WS}([W_T]-[S_T]))[S_f] - [S_T]
\end{align}
Generally, we find that this has one positive solution for $[S_f]$. 
Using this solution, we solve for $[W]$ and then use the kinetic equation so solve for $[S_T^p]$. The rest of the concentrations are then straightforward to calculate without any further need to solve any equations.




\section{Goldbeter Push-Pull Amplifier}

In the Goldbeter model, we have a push-pull amplifier with a substrate $S$, a writer (kinase) $W$ and an eraser (phosphatase) $E$ with no background (de)phosphorylation~\cite{Goldbeter1981}. In addition, we lack the intermediate states directly after phosphorylation $WS^p$ and dephosphorylation $ES^u$. These two states are assumed to be very short-lived.

\textbf{Reactions:}
\begin{gather}
W + S^u \leftrightarrows WS^u  \rightarrow W + S^p\\
E + S^p \leftrightarrows ES^p  \rightarrow E + S^u
\end{gather}

\textbf{Total Concentrations:}
\begin{itemize}
\item Total writer: $[W_T] = [W] + [WS^u]$
\item Total Eraser: $[E_T] = [E] + [ES^p]$
\item Total substrate: $[S_T] = [S^u_T] + [S^p_T]$
\item Total unphosporylated substrate: $[S^u_T] = [S^u] + [WS^u]$
\item Total phosporylated substrate: $[S^p_T] = [S^p] + [ES^p]$
\end{itemize}


\textbf{Binding Energies:}
\begin{itemize}
\item Writer + substrate: $\Delta\epsilon_{WS}$
\item Eraser + substrate: $\Delta\epsilon_{ES}$
\end{itemize}

\textbf{One-way Reaction Rates:}
\begin{itemize}
\item Phosphorylation of substrate by writer: $k_{WS}^p$
\item Dephosphorylation of substrate by eraser: $k_{ES}^u$
\end{itemize}

\textbf{Partition Functions and Probabilities:}
\begin{itemize}
\item Writer: $Z_W = 1 + e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[S^u])}$
\item Eraser: $Z_E = 1 + e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[S^p])}$
\item Unphosphorylated substrate: $Z_{S^u} = 1 + e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[W])}$
\item Phosphorylated substrate: $Z_{S^p} = 1 + e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[E])}$
\end{itemize}
We define the reaction velocities
\begin{align}
v_{WS} &= e^{-\beta\Delta\epsilon_{WS}}\\
v_{ES} &= e^{-\beta\Delta\epsilon_{ES}}
\end{align}
The associated conditional probabilities are then
\begin{align}
p(W|S^u,S^p, E) &= \frac{[W]}{[W_T]} = \frac{1}{Z_W} =  \frac{1}{1 + v_{WS}[S^u]}\\
p(WS^u|S^u,S^p, E) &= \frac{[WS^u]}{[W_T]}  = \frac{e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[S^u])}}{Z_W} =  \frac{v_{WS}[S^u]}{1 + v_{WS}[S^u]}
\end{align}
\begin{align}
p(E|S^u,S^p, W) &= \frac{[E]}{[E_T]} = \frac{1}{Z_E} =  \frac{1}{1 + v_{ES}[S^p]}\\
p(ES^p|S^u,S^p, W) &= \frac{[ES^p]}{[E_T]}  = \frac{e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[S^p])}}{Z_E} =  \frac{v_{ES}[S^p]}{1 + v_{ES}[S^p]}
\end{align}

\begin{align}
p(S^u|E, W) &= \frac{[S^u]}{[S^u_T]} = \frac{1}{Z_{S^u}} = \frac{1}{1 + v_{WS}[W]}\\
p(WS^u|E, W) &= \frac{[WS^u]}{[S^u_T]} = \frac{ e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[W])}}{Z_{S^u}} = \frac{v_{WS}[W]}{1 + v_{WS}[W]}
\end{align}
\begin{align}
p(S^p|E, W) &= \frac{[S^p]}{[S^p_T]} = \frac{1}{Z_{S^p}} = \frac{1}{1 + v_{ES}[E]}\\
p(ES^p|E, W) &= \frac{[ES^p]}{[S^p_T]} = \frac{ e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[E])}}{Z_{S^p}} = \frac{v_{ES}[E]}{1 + v_{ES}[E]}
\end{align}

\textbf{Reactions in Detailed Balance:}
\begin{align}
\frac{[W]}{[W_T]} & = \frac{1}{1 + v_{WS}[S^u]}\label{eq:gbW}\\
\frac{[E]}{[E_T]} & = \frac{1}{1 + v_{ES}[S^p]}\label{eq:gbE}\\
\frac{[S^u]}{[S^u_T]} &= \frac{1}{1 + v_{WS}[W]}\label{eq:gbSu}\\
\frac{[S^p]}{[S^p_T]} &=  \frac{1}{1 + v_{ES}[E]}\label{eq:gbSp}
\end{align}

\textbf{Reactions not in  Detailed Balance:}
We only focus on the equations for the total amounts of phosphorylated and unphosphorylated substrate, allowing us to ignore any of the reactions in detailed balance.
\begin{align}
\dv{[S^p_T]}{t} &= k_{WS}^p[WS^u] - k_{ES}^u[ES^p]\\
&= k_{WS}^p[S^u_T]p(WS^u|E, W) - k_{ES}^u[S^p_T]p(ES^p|E, W)\\
&= k_{WS}^p([S_T]-[S^p_T])p(WS^u|E, W) - k_{ES}^u[S^p_T]p(ES^p|E, W)
\end{align}
Setting this to zero, we get
\begin{align}
\frac{[S_T^p]}{[S_T]} &= \frac{k_{WS}^p p(WS^u|E,W)}{k_{WS}^p p(WS^u|E,W) + k_{ES}^u p(ES^p|E,W)}\\
 &= \frac{v_{WS}^p p(WS^u|E,W)}{v_{WS}^p p(WS^u|E,W) + p(ES^p|E,W)}\\
\end{align}
where we have defined the reaction velocity
\begin{align}
v_{WS}^p &= \frac{k_{WS}^p}{k_{ES}^u}
\end{align}




\section{Complete Push-Pull Amplifier}

This model generalizes the Goldbeter model to include the intermediate states and background (de)phosphorylation.

\textbf{Reactions:}
\begin{gather}
W + S^u \leftrightarrows WS^u \rightarrow WS^p \leftrightarrows W + S^p\\
E + S^p \leftrightarrows ES^p \rightarrow ES^u \leftrightarrows E + S^u
\end{gather}

\textbf{Background:}
\begin{gather}
S^p \leftrightarrows S^u\\
WS^p  \leftrightarrows WS^u\\
ES^p  \leftrightarrows ES^u
\end{gather}


\textbf{Total Concentrations:}
\begin{itemize}
\item Total writer: $[W_T] = [W] + [WS^p] + [WS^u]$
\item Total Eraser: $[E_T] = [E]  + [ES^p] + [ES^u]$
\item Total substrate: $[S_T] = [S^u_T] + [S^p_T]$
\item Total unphosporylated substrate: $[S^u_T] = [S^u] + [WS^u] + [ES^u]$
\item Total phosporylated substrate: $[S^p_T] = [S^p] + [WS^p] + [ES^p]$
\end{itemize}


\textbf{Binding Energies:}
\begin{itemize}
\item Writer + substrate: $\Delta\epsilon_{WS}$
\item Eraser + substrate: $\Delta\epsilon_{ES}$
\end{itemize}

\textbf{One-way Reaction Rates:}
\begin{itemize}
\item Phosphorylation of substrate by writer: $k_{WS}^p$
\item Dephosphorylation of substrate by eraser: $k_{ES}^u$
\item Background phosphorylation of substrate (independent of binding state): $k_S^p$
\item Background dephosphorylation of substrate (independent of binding state): $k_S^u$
\end{itemize}

\textbf{Partition Functions and Probabilities:}
\begin{itemize}
\item Writer: $Z_W = 1 + e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[S^p])} + e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[S^u])}$
\item Eraser: $Z_E = 1 + e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[S^p])} + e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[S^u])}$
\item Unphosphorylated substrate: $Z_{S^u} = 1 + e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[W])} + e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[E])}$
\item Phosphorylated substrate: $Z_{S^p} = 1  + e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[W])} + e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[E])}$
\end{itemize}
We define the reaction velocities
\begin{align}
v_{WS} &= e^{-\beta\Delta\epsilon_{WS}}\\
v_{ES} &= e^{-\beta\Delta\epsilon_{ES}}
\end{align}
The associated conditional probabilities are then
\begin{align}
p(W|S^u,S^p, E) &= \frac{[W]}{[W_T]} = \frac{1}{Z_W} =  \frac{1}{1 + v_{WS}([S^p]+[S^u])}\\
p(WS^u|S^u,S^p, E) &= \frac{[WS^u]}{[W_T]}  = \frac{e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[S^u])}}{Z_W} =  \frac{v_{WS}[S^u]}{1 + v_{WS}([S^p]+[S^u])}\\
p(WS^p|S^u,S^p, E) &= \frac{[WS^p]}{[W_T]}  = \frac{e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[S^p])}}{Z_W} =  \frac{v_{WS}[S^p]}{1 + v_{WS}([S^p]+[S^u])}
\end{align}
\begin{align}
p(E|S^u,S^p, W) &= \frac{[E]}{[E_T]} = \frac{1}{Z_E} =  \frac{1}{1 + v_{ES}([S^p]+[S^u])}\\
p(ES^u|S^u,S^p, W) &= \frac{[ES^u]}{[E_T]}  = \frac{e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[S^u])}}{Z_E} =  \frac{v_{ES}[S^u]}{1 + v_{ES}([S^p]+[S^u])}\\
p(ES^p|S^u,S^p, W) &= \frac{[ES^p]}{[E_T]}  = \frac{e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[S^p])}}{Z_E} =  \frac{v_{ES}[S^p]}{1 + v_{ES}([S^p]+[S^u])}
\end{align}

\begin{align}
p(S^u|E, W) &= \frac{[S^u]}{[S^u_T]} = \frac{1}{Z_{S^u}} = \frac{1}{1 + v_{WS}[W]+ v_{ES}[E]}\\
p(WS^u|E, W) &= \frac{[WS^u]}{[S^u_T]} = \frac{ e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[W])}}{Z_{S^u}} = \frac{v_{WS}[W]}{1 + v_{WS}[W]+ v_{ES}[E]}\\
p(ES^u|E, W) &= \frac{[ES^u]}{[S^u_T]} = \frac{ e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[E])}}{Z_{S^u}} = \frac{v_{ES}[E]}{1 + v_{WS}[W]+ v_{ES}[E]}
\end{align}
\begin{align}
p(S^p|E, W) &= \frac{[S^p]}{[S^p_T]} = \frac{1}{Z_{S^p}} = \frac{1}{1 + v_{WS}[W]+ v_{ES}[E]}\\
p(WS^p|E, W) &= \frac{[WS^p]}{[S^p_T]} = \frac{ e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[W])}}{Z_{S^p}} = \frac{v_{WS}[W]}{1 + v_{WS}[W]+ v_{ES}[E]}\\
p(ES^p|E, W) &= \frac{[ES^p]}{[S^p_T]} = \frac{ e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[E])}}{Z_{S^p}} = \frac{v_{ES}[E]}{1 + v_{WS}[W]+ v_{ES}[E]}
\end{align}

\textbf{Reactions in Detailed Balance:}
\begin{align}
\frac{[W]}{[W_T]} & = \frac{1}{1 + v_{WS}([S^p]+[S^u])}\\
\frac{[E]}{[E_T]} & = \frac{1}{1 + v_{ES}([S^p]+[S^u])}\\
\frac{[S^u]}{[S^u_T]} &= \frac{1}{1 + v_{WS}[W]+ v_{ES}[E]}\\
\frac{[S^p]}{[S^p_T]} &=  \frac{1}{1+ v_{WS}[W] + v_{ES}[E]}
\end{align}

\textbf{Reactions not in  Detailed Balance:}
\begin{align}
\dv{[S^p_T]}{t} &= k_{WS}^p[WS^u] - k_{ES}^u[ES^p] + k_S^p[S^u_T] - k_S^u[S^p_T] \\
&= k_{WS}^p[S^u_T]p(WS^u|E, W) - k_{ES}^u[S^p_T]p(ES^p|E, W) + k_S^p[S^u_T] - k_S^u[S^p_T]\\
&= k_{WS}^p([S_T]-[S^p_T])p(WS^u|E, W) - k_{ES}^u[S^p_T]p(ES^p|E, W) + k_S^p([S_T]-[S^p_T]) - k_S^u[S^p_T]
\end{align}
Setting this to zero, we get
\begin{align}
\frac{[S_T^p]}{[S_T]} &= \frac{k_{WS}^p p(WS^u|E,W) + k_S^p}{k_{WS}^p p(WS^u|E,W) + k_{ES}^u p(ES^p|E,W) + k_S^p + k_S^u}\\
 &= \frac{v_{WS}^p p(WS^u|E,W) + v_S^p}{v_{WS}^p p(WS^u|E,W) + v_{ES}^u p(ES^p|E,W) + v_S^p + 1}\\
\end{align}
where we have defined the reaction velocities
\begin{align}
v_{WS}^p &= \frac{k_{WS}^p}{k_S^u}\\
v_{ES}^u &= \frac{k_{ES}^u}{k_S^u}\\
v_S^p &= \frac{k_S^p}{k_S^u}
\end{align}



\textbf{Numerical Strategy:}

We assume that  $[W_T]$, $[E_T]$, and $[S_T]$ are known. 
Add together Eqs.~\eqref{eq:onewaySu} and \eqref{eq:onewaySp} and defining $[S_f] = [S^p]+[S^u]$, 
we find three equations that can be solved for $[W]$, $[E]$, and $[S_f]$,
\begin{align}
\frac{[W]}{[W_T]} & = \frac{1}{1 + v_{WS}[S_f]}\\
\frac{[E]}{[E_T]} & = \frac{1}{1 + v_{ES}[S_f]}\\
\frac{[S_f]}{[S_T]} &= \frac{1}{1 + v_{WS}[W]+ v_{ES}[E]}
\end{align}
Combining these equations, we find a cubic equation in terms of $S_f$,

\begin{align}
0 &= v_{WS}v_{ES}[S_f]^3 +\qty(v_{WS}+v_{ES} + v_{WS}v_{ES}([W_T]+[E_T]- [S_T])) [S_f]^2\\
&\qquad + \qty(1+v_{WS}([W_T]-[S_T]) + v_{ES}([E_T]-[S_T]))[S_f] - [S_T]
\end{align}
Generally, we find that this has one positive solution for $[S_f]$. 
Using this solution, we solve for $[W]$ and $[E]$ and then use the kinetic equation to solve for $[S_T^p]$. The rest of the concentrations are then straightforward to calculate without any further need to solve any equations.



%
%\section{Push-Pull to Goldbeter}
%
%Can't group $WS^p$ with $W$ because that means that $W$ or $WS^p$ can bind to $S^u$
%
%If $W$ in Goldbeter is actually the total of $W$ and $WS^p$, then what about $S^p$?
%
%\begin{align}
%[\tilde{W}] &= [W] + [WS^p]\\
%[\tilde{E}] &= [E] + [ES^u]\\
%[\tilde{S}^p_T] &= [S^p_T] - [WS^p]\\
%[\tilde{S}^u_T] &= [S^u_T] - [ES^u]
%\end{align}
%and set $k_S^p=k_S^u=0$
%
%\begin{align}
%\tilde{k}_{WS}^p &= k_{WS}^pv_{WS}\\
%\tilde{k}_{ES}^u &= k_{ES}^uv_{ES}
%\end{align}
%
%Also have to convert $k_{WS}^p$ and $k_{ES}^p$


\section{Two-step Amplifier}

\textbf{Reactions:}
\begin{gather}
R + W^u \leftrightarrows RW^u \rightarrow RW^p \leftrightarrows R + W^p\\
E_W + W^p \leftrightarrows E_WW^p \rightarrow E_WW^u \leftrightarrows E_W + W^u\\
W^p + S^u \leftrightarrows W^pS^u \rightarrow W^pS^p \leftrightarrows W^p + S^p\\
E_S + S^p \leftrightarrows E_SS^p \rightarrow E_SS^u \leftrightarrows E_S + S^u
\end{gather}
Are these viable?
\begin{align}
W^u + S^u \leftrightarrows W^uS^u\\
W^u + S^p \leftrightarrows W^uS^p
\end{align}

\textbf{Background:}
\begin{gather}
\text{any } W^p \leftrightarrows \text{any } W^u\\
\text{any } S^p \leftrightarrows \text{any } S^u\\
\end{gather}

\textbf{Total Concentrations:}
\begin{itemize}
\item Total writer: $[W_T] = [W^u_T] + [W^p_T]$
\item Total unphosporylated writer: $[W^u_T] = [W^u] + [RW^u] + [EW^u]$
\item Total phosporylated writer: $[W^p_T] = [W^p] + [W^pS^p] + [W^pS^u] + [RW^p] + [EW^p]$
\item Total Writer-Eraser: $[E_{WT}] = [E_W]  + [E_WW^p] + [E_WW^u]$
\item Total Substrate-Eraser: $[E_{ST}] = [E_S]  + [E_SS^p] + [E_SS^u]$
\item Total substrate: $[S_T] = [S^u_T] + [S^p_T]$
\item Total unphosporylated substrate: $[S^u_T] = [S^u] + [W^pS^u] + [W^uS^u] + [ES^u]$
\item Total phosporylated substrate: $[S^p_T] = [S^p] +  [W^pS^p] + [W^uS^p] + [ES^p]$
\end{itemize}


\textbf{Binding Energies:}
\begin{itemize}
\item Receptor + Writer: $\Delta\epsilon_{RW}$
\item Writer-Eraser + Writer: $\Delta\epsilon_{E_WW}$
\item Writer + substrate: $\Delta\epsilon_{WS}$
\item Substrate-Eraser + substrate: $\Delta\epsilon_{E_SS}$
\end{itemize}


\textbf{One-way Reaction Rates:}
\begin{itemize}
\item Phosphorylation of writer by receptor: $k_{RW}^p$
\item Dephosphorylation of writer by eraser: $k_{E_WW}^u$
\item Phosphorylation of substrate by writer: $k_{WS}^p$
\item Dephosphorylation of substrate by eraser: $k_{E_SS}^u$
\item Background phosphorylation of writer (independent of binding state): $k_W^p$
\item Background dephosphorylation of writer (independent of binding state): $k_W^u$
\item Background phosphorylation of substrate (independent of binding state): $k_S^p$
\item Background dephosphorylation of substrate (independent of binding state): $k_S^u$
\end{itemize}

\textbf{Partition Functions and Probabilities:}
\begin{itemize}
\item Unphosphorylated writer: $Z_{W^u} = 1 + e^{-\beta\qty(\Delta\epsilon_{RW} -k_BT \log[R]) + e^{-\beta\qty(\Delta\epsilon_{E_WW} -k_BT \log[E_W])}}$
\item Phosphorylated writer: $Z_{W^p} = 1 + e^{-\beta\qty(\Delta\epsilon_{RW} -k_BT \log[R]) + e^{-\beta\qty(\Delta\epsilon_{E_WW} -k_BT \log[E_W])}} + e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[S^p])} + e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[S^u])}$
\item Eraser: $Z_E = 1 + e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[S^p])} + e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[S^u])}$
\item Unphosphorylated substrate: $Z_{S^u} = 1 + e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[W])} + e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[E])}$
\item Phosphorylated substrate: $Z_{S^p} = 1  + e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[W])} + e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[E])}$
\end{itemize}
We define the reaction velocities
\begin{align}
v_{WS} &= e^{-\beta\Delta\epsilon_{WS}}\\
v_{ES} &= e^{-\beta\Delta\epsilon_{ES}}
\end{align}
The associated conditional probabilities are then
\begin{align}
p(W^u|S^u,S^p, R, E_W, E_S) &= \frac{[W^u]}{[W^u_T]} = \frac{1}{Z_{W^u}} =  \frac{1}{1 + v_{RW}[R] + v_{E_WW}[E_W]}\\
p(RW^u|S^u,S^p, R, E_W, E_S) &= \frac{[RW^u]}{[W^u_T]}  = \frac{e^{-\beta\qty(\Delta\epsilon_{RW} -k_BT \log[R])}}{Z_{W^u}} =  \frac{v_{RW}[R]}{1 + v_{RW}[R] + v_{E_WW}[E_W]}\\
p(E_WW^u|S^u,S^p, R, E_W, E_S) &= \frac{[E_WW^u]}{[W^u_T]}  = \frac{e^{-\beta\qty(\Delta\epsilon_{E_WW} -k_BT \log[E_W])}}{Z_{W^u}} =  \frac{ v_{E_WW}[E_W]}{1 + v_{RW}[R] + v_{E_WW}[E_W]}
\end{align}
\comment{\textbf{Continue Here}}
\begin{align}
p(W^p|S^u,S^p, R, E_W, E_S) &= \frac{[W^p]}{[W^p_T]} = \frac{1}{Z_W} =  \frac{1}{1 + v_{WS}([S^p]+[S^u])}\\
p(RW^p|S^u,S^p, R, E_W, E_S) &= \frac{[RW^p]}{[W^p_T]}  = \frac{e^{-\beta\qty(\Delta\epsilon_{RW} -k_BT \log[R])}}{Z_W} =  \frac{v_{RW}[R]}{1 + v_{RW}[R] + v_{E_WW}[E_W]}\\
p(E_WW^p|S^u,S^p, R, E_W, E_S) &= \frac{[E_WW^p]}{[W^p_T]}  = \frac{e^{-\beta\qty(\Delta\epsilon_{E_WW} -k_BT \log[E_W])}}{Z_W} =  \frac{ v_{E_WW}[E_W]}{1 + v_{RW}[R] + v_{E_WW}[E_W]}\\
p(W^pS^u|S^u,S^p, R, E_W, E_S) &= \frac{[W^pS^u]}{[W^p_T]}  = \frac{e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[S^u])}}{Z_W} =  \frac{v_{WS}[S^u]}{1 + v_{WS}([S^p]+[S^u])}\\
p(W^pS^p|S^u,S^p, R, E_W, E_S) &= \frac{[W^pS^p]}{[W^p_T]}  = \frac{e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[S^p])}}{Z_W} =  \frac{v_{WS}[S^p]}{1 + v_{WS}([S^p]+[S^u])}
\end{align}
\begin{align}
p(E|S^u,S^p, W) &= \frac{[E]}{[E_T]} = \frac{1}{Z_E} =  \frac{1}{1 + v_{ES}([S^p]+[S^u])}\\
p(ES^u|S^u,S^p, W) &= \frac{[ES^u]}{[E_T]}  = \frac{e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[S^u])}}{Z_E} =  \frac{v_{ES}[S^u]}{1 + v_{ES}([S^p]+[S^u])}\\
p(ES^p|S^u,S^p, W) &= \frac{[ES^p]}{[E_T]}  = \frac{e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[S^p])}}{Z_E} =  \frac{v_{ES}[S^p]}{1 + v_{ES}([S^p]+[S^u])}
\end{align}

\begin{align}
p(S^u|E, W) &= \frac{[S^u]}{[S^u_T]} = \frac{1}{Z_{S^u}} = \frac{1}{1 + v_{WS}[W]+ v_{ES}[E]}\\
p(WS^u|E, W) &= \frac{[WS^u]}{[S^u_T]} = \frac{ e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[W])}}{Z_{S^u}} = \frac{v_{WS}[W]}{1 + v_{WS}[W]+ v_{ES}[E]}\\
p(ES^u|E, W) &= \frac{[ES^u]}{[S^u_T]} = \frac{ e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[E])}}{Z_{S^u}} = \frac{v_{ES}[E]}{1 + v_{WS}[W]+ v_{ES}[E]}
\end{align}
\begin{align}
p(S^p|E, W) &= \frac{[S^p]}{[S^p_T]} = \frac{1}{Z_{S^p}} = \frac{1}{1 + v_{WS}[W]+ v_{ES}[E]}\\
p(WS^p|E, W) &= \frac{[WS^p]}{[S^p_T]} = \frac{ e^{-\beta\qty(\Delta\epsilon_{WS} -k_BT \log[W])}}{Z_{S^p}} = \frac{v_{WS}[W]}{1 + v_{WS}[W]+ v_{ES}[E]}\\
p(ES^p|E, W) &= \frac{[ES^p]}{[S^p_T]} = \frac{ e^{-\beta\qty(\Delta\epsilon_{ES} -k_BT \log[E])}}{Z_{S^p}} = \frac{v_{ES}[E]}{1 + v_{WS}[W]+ v_{ES}[E]}
\end{align}


textbf{Reactions not in  Detailed Balance:}
\begin{align}
\dv{[S^p_T]}{t} &= k_{WS}^p[WS^u] - k_{E_SS}^u[ES^p] + k_S^p[S^u_T] - k_S^u[S^p_T]\\
\dv{[W^p_T]}{t} &= k_{RW}^p[RW^u] - k_{E_WW}^u[E_WW^p] + k_W^p[W^u_T] - k_W^u[w^p_T]
\end{align}

\bibliography{molecular_circuits}

\end{document}

